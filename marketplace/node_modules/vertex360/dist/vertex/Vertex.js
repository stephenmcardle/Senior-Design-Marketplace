"use strict";var _prototypeProperties=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},formatCallback=require("./callback"),Router=require("./Router"),Vertex=function(){function e(){_classCallCheck(this,e),this.routes=[],this.staticDir=null}return _prototypeProperties(e,null,{expressVersion:{value:function(e){var t=this;return e.use("/turbo",function(e,r,o){r.json({confirmation:"success",data:JSON.stringify(t.routes)})}),t.routes.forEach(function(t){e.use(t.stem,function(e,r,o){r.json({confirmation:"success",data:t.stem})})}),e},writable:!0,configurable:!0},useStatic:{value:function(e){this.staticDir=e},writable:!0,configurable:!0},use:{value:function(e,t){t.setStem(e),this.routes.push(t)},writable:!0,configurable:!0},get:{value:function(e,t){var r=new Router;r.setStem("/"),r.get(e,t),this.routes.push(r)},writable:!0,configurable:!0},post:{value:function(e,t){var r=new Router;r.setStem("/"),r.post(e,t),this.routes.push(r)},writable:!0,configurable:!0},routeNotFound:{value:function(e,t){e.httpMethod.toLowerCase();return{isBase64Encoded:!1,statusCode:501,headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation:"fail",message:t})}},writable:!0,configurable:!0},handle:{value:function(e){var t=e.event,r=e.callback,o=t.httpMethod.toLowerCase();if("post"==o){for(var a=null,n=0;n<this.routes.length;n++){var i=this.routes[n];if(null!=i.handlePost(t)){a=i.handlePost(t);break}}if(null==a)return void r(null,this.routeNotFound(t,o+" route not defined for this path: "+t.path));var s=formatCallback(t,r,a.routeParams);return void a.routeHandler(s.req,s.res)}if("put"==o){for(var a=null,n=0;n<this.routes.length;n++){var i=this.routes[n];if(null!=i.handlePut(t)){a=i.handlePut(t);break}}if(null==a)return void r(null,this.routeNotFound(t,o+" route not defined for this path: "+t.path));var s=formatCallback(t,r,a.routeParams);return void a.routeHandler(s.req,s.res)}if("delete"==o){for(var a=null,n=0;n<this.routes.length;n++){var i=this.routes[n];if(null!=i.handleDelete(t)){a=i.handleDelete(t);break}}if(null==a)return void r(null,this.routeNotFound(t,o+" route not defined for this path: "+t.path));var s=formatCallback(t,r,a.routeParams);return void a.routeHandler(s.req,s.res)}if("get"==o){if(-1==t.path.indexOf(".")){for(var a=null,n=0;n<this.routes.length;n++){var i=this.routes[n];if(null!=i.handleGet(t)){a=i.handleGet(t);break}}if(null==a)return void r(null,this.routeNotFound(t,o+" route not defined for this path: "+t.path));var s=formatCallback(t,r,a.routeParams);return void a.routeHandler(s.req,s.res)}if(void 0==t.headers||null==t.headers)return void r(null,{isBase64Encoded:!1,statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation:"fail",data:"Missing Turbo-Vertex-App header (headers is null)"})});var u=t.headers["Turbo-Vertex-App"];if(null==u)return void r(null,{isBase64Encoded:!1,statusCode:500,headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation:"fail",data:"Missing Turbo-Vertex-App header"})});r(null,{isBase64Encoded:!1,statusCode:301,headers:{Location:"https://"+("cdn.turbo360-vertex.com/"+u+"/"+(this.staticDir||"public")+t.path).replace("//","/")},body:""})}},writable:!0,configurable:!0}}),e}();module.exports=Vertex;