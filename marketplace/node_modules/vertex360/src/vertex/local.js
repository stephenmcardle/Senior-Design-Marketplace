var express = require('express')
var path = require('path')
var favicon = require('serve-favicon')
var logger = require('morgan')
var cookieParser = require('cookie-parser')
var bodyParser = require('body-parser')
var sessions = require('client-sessions')
require('dotenv').config()

const basePath = __dirname + '/../../../../'

module.exports = {

	app: function(){
		var app = express()

		app.use(bodyParser.json())
		app.use(bodyParser.urlencoded({ extended: false }))

		app.use(cookieParser())
		app.use(logger('dev'))

		if (process.env.SESSION_SECRET){
			app.use(sessions({
				cookieName: 'vertexSession',
				secret: process.env.SESSION_SECRET,
				duration: 24*60*60*1000, // 1 day
				activeDuration:30*60*1000
			}))
		}

		var viewsPath = path.join(basePath, 'views')
		app.set('views', viewsPath)

		var publicPath = path.join(basePath, 'public')
		app.use(express.static(publicPath))

		app.set('view engine', 'mustache')
		app.engine('mustache', require('hogan-middleware').__express)


		return app
	},

	router: function(){
		var router = new express.Router()
		return router
	}

}
